# Python wrapper for exports

This folder contains all files required to generate a library which can allow 
you to use an export generated by N2D2 in your Python environment.

## Details about the files

In this folder, you should find
- `n2d2_export.pyx`: file used to explain how to build the library
- `setup_export.py`: file used to build the library

## Steps to use the wrapper

### Step 1: Generate your export with N2D2

Please refer to the sections of how to generate an export wth the [Python API](https://cea-list.github.io/N2D2-docs/python_api/export.html) or the [Ini API](https://cea-list.github.io/N2D2-docs/export/CPP.html).


### Step 2: Generate your Python environment

To create your own environment, you can use Anaconda or Virtualenv


### Step 3: Install Cython

To use this wrapper, you have to install `cython` in your environment
```
pip install Cython
```


### Step 4: Copy the files into your export folder

Copy `n2d2_export.pyx` and `setup_export.py` at the root of your export

```
MyExport
├── dnn
├── include
├── src
├── statistics
├── stimuli
├── stimuli.link
├── stimuli.list
├── stimuli_stats
├── Makefile
├── README.md
├── n2d2_export.pyx   <----
└── setup_export.py   <----
```


### Step 5: Change n2d2_export.pyx (optional)

It is possible you would have to make some modifications in this file. <br>
For example, be sure of the inputs datatype by seeing **NB_BITS** and **UNSIGNED_DATA** in `include/params.h` 
and the types of **DATA_T** and **UDATA_T** in `include/typedefs.h`.

If **NB_BITS** is different than 8 and **UNSIGNED_DATA** is not 1, 
change in `n2d2_export.pyx` the type of the inputs

```python
cdef uint8_t[::1] input_view = inputs
     ^^^^^^^
n.propagate[uint8_t, int32_t](&input_view[0], &outputs)
            ^^^^^^^
```

Moreover if you want to make modifications in the library, please do it in this file.


### Step 6: Build the library

To build the library, run the followinf command in your Python environment
```
python setup_export.py build_ext --inplace
```

To activate the *save_outputs* option, run
```
python setup_export.py --save_outputs build_ext --inplace
```
This option give you the opportunity to save the outputs of all layers each time there is a network forward.

At the end of the build phase, you should have a library named `n2d2_export.so` (if you are on Linux) 
or `n2d2_export.pyd` (if you are on Windows).


### Step 7: Play with it!

To use the wrapper, simply import it in your scripts

```python
import numpy as np
import n2d2_export

inputs = np.random.randint(255, size=1024, dtype=np.uint8)

outputs = n2d2_export.model_forward(inputs)

print(outputs)
```